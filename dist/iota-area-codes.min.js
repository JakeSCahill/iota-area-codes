!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).IotaAreaCodes={})}(this,function(e){"use strict";var t=function(){function e(){}return e.NORMAL=10,e.EXTRA=11,e}();var n,r,i=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=90,r=180;class i{constructor(e,t,i,o,_){this.latitudeLo=e,this.longitudeLo=t,this.latitudeHi=i,this.longitudeHi=o,this.codeLength=_,this.latitudeCenter=Math.min(e+(i-e)/2,n),this.longitudeCenter=Math.min(t+(o-t)/2,r)}getLatitudeHeight(){return this.latitudeHi-this.latitudeLo}getLongitudeWidth(){return this.longitudeHi-this.longitudeLo}}t.CodeArea=i;class o{constructor(e){this.code=e}getCode(){return this.code}isPadded(){return this.code.indexOf(o.PADDING_CHARACTER_)>=0}static isValid(e){if(!e)return!1;if(-1===e.indexOf(o.SEPARATOR_))return!1;if(e.indexOf(o.SEPARATOR_)!==e.lastIndexOf(o.SEPARATOR_))return!1;if(1===e.length)return!1;if(e.indexOf(o.SEPARATOR_)>o.SEPARATOR_POSITION_||e.indexOf(o.SEPARATOR_)%2==1)return!1;if(e.indexOf(o.PADDING_CHARACTER_)>-1){if(0===e.indexOf(o.PADDING_CHARACTER_))return!1;const t=e.match(new RegExp("("+o.PADDING_CHARACTER_+"+)","g"));if(t.length>1||t[0].length%2==1||t[0].length>o.SEPARATOR_POSITION_-2)return!1;if(e.charAt(e.length-1)!==o.SEPARATOR_)return!1}if(e.length-e.indexOf(o.SEPARATOR_)-1==1)return!1;const t=e.replace(new RegExp("\\"+o.SEPARATOR_+"+"),"").replace(new RegExp(o.PADDING_CHARACTER_+"+"),"");for(let e=0,n=t.length;e<n;e++){const n=t.charAt(e).toUpperCase();if(n!==o.SEPARATOR_&&-1===o.CODE_ALPHABET_.indexOf(n))return!1}return!0}static isPadded(e){return new o(e).isPadded()}static isShort(e){return!!o.isValid(e)&&(e.indexOf(o.SEPARATOR_)>=0&&e.indexOf(o.SEPARATOR_)<o.SEPARATOR_POSITION_)}static isFull(e){if(!o.isValid(e))return!1;if(o.isShort(e))return!1;if(o.CODE_ALPHABET_.indexOf(e.charAt(0).toUpperCase())*o.ENCODING_BASE_>=2*o.LATITUDE_MAX_)return!1;if(e.length>1){if(o.CODE_ALPHABET_.indexOf(e.charAt(1).toUpperCase())*o.ENCODING_BASE_>=2*o.LONGITUDE_MAX_)return!1}return!0}contains(e,t){const n=o.decode(this.getCode());return n.latitudeLo<=e&&e<n.latitudeHi&&n.longitudeLo<=t&&t<n.longitudeHi}static encode(e,t,n=o.CODE_PRECISION_NORMAL){if(n<2||n<o.PAIR_CODE_LENGTH_&&n%2==1)throw new Error("IllegalArgumentException: Invalid Open Location Code length");n=Math.min(o.MAX_DIGIT_COUNT,n);let r=o.clipLatitude(e);const i=o.normalizeLongitude(t);90===r&&(r-=o.computeLatitudePrecision(n));let _=o.encodePairs(r,i,Math.min(n,o.PAIR_CODE_LENGTH_));return n>o.PAIR_CODE_LENGTH_&&(_+=o.encodeGrid(r,i,n-o.PAIR_CODE_LENGTH_)),_}static decode(e){if(!o.isFull(e))throw new Error("IllegalArgumentException: Passed Open Location Code is not a valid full code: "+e);let t=e.replace(o.SEPARATOR_,"");t=(t=t.replace(new RegExp(o.PADDING_CHARACTER_+"+"),"")).toUpperCase();const n=o.decodePairs(t.substring(0,o.PAIR_CODE_LENGTH_));if(t.length<=o.PAIR_CODE_LENGTH_)return n;const r=o.decodeGrid(t.substring(o.PAIR_CODE_LENGTH_,o.MAX_DIGIT_COUNT));return new i(n.latitudeLo+r.latitudeLo,n.longitudeLo+r.longitudeLo,n.latitudeLo+r.latitudeHi,n.longitudeLo+r.longitudeHi,n.codeLength+r.codeLength)}static recoverNearest(e,t,n){if(!o.isShort(e)){if(o.isFull(e))return e;throw new Error("ValueError: Passed short code is not valid: "+e)}const r=o.clipLatitude(t),i=o.normalizeLongitude(n),_=e.toUpperCase(),d=o.SEPARATOR_POSITION_-_.indexOf(o.SEPARATOR_),a=Math.pow(20,2-d/2),A=a/2,u=o.decode(o.encode(r,i).substr(0,d)+_);return r+A<u.latitudeCenter&&u.latitudeCenter-a>=-o.LATITUDE_MAX_?u.latitudeCenter-=a:r-A>u.latitudeCenter&&u.latitudeCenter+a<=o.LATITUDE_MAX_&&(u.latitudeCenter+=a),i+A<u.longitudeCenter?u.longitudeCenter-=a:i-A>u.longitudeCenter&&(u.longitudeCenter+=a),o.encode(u.latitudeCenter,u.longitudeCenter,u.codeLength)}static shorten(e,t,n){if(!o.isFull(e))throw new Error("ValueError: Passed code is not valid and full: "+e);if(-1!==e.indexOf(o.PADDING_CHARACTER_))throw new Error("ValueError: Cannot shorten padded codes: "+e);const r=e.toUpperCase(),i=o.decode(r);if(i.codeLength<o.MIN_TRIMMABLE_CODE_LEN_)throw new Error("ValueError: Code length must be at least "+o.MIN_TRIMMABLE_CODE_LEN_);const _=o.clipLatitude(t),d=o.normalizeLongitude(n),a=Math.max(Math.abs(i.latitudeCenter-_),Math.abs(i.longitudeCenter-d));for(let e=o.PAIR_RESOLUTIONS_.length-2;e>=1;e--)if(a<.3*o.PAIR_RESOLUTIONS_[e])return r.substring(2*(e+1));return r}static clipLatitude(e){return Math.min(90,Math.max(-90,e))}static computeLatitudePrecision(e){return e<=10?Math.pow(20,Math.floor(e/-2+2)):Math.pow(20,-3)/Math.pow(o.GRID_ROWS_,e-10)}static normalizeLongitude(e){let t=e;for(;t<-180;)t+=360;for(;t>=180;)t-=360;return t}static encodePairs(e,t,n){let r="",i=e+o.LATITUDE_MAX_,_=t+o.LONGITUDE_MAX_,d=0;for(;d<n;){const e=o.PAIR_RESOLUTIONS_[Math.floor(d/2)];let t=Math.floor(i/e);i-=t*e,r+=o.CODE_ALPHABET_.charAt(t),d+=1,_-=(t=Math.floor(_/e))*e,r+=o.CODE_ALPHABET_.charAt(t),(d+=1)===o.SEPARATOR_POSITION_&&d<n&&(r+=o.SEPARATOR_)}return r.length<o.SEPARATOR_POSITION_&&(r+=Array(o.SEPARATOR_POSITION_-r.length+1).join(o.PADDING_CHARACTER_)),r.length===o.SEPARATOR_POSITION_&&(r+=o.SEPARATOR_),r}static encodeGrid(e,t,n){let r="",i=o.GRID_SIZE_DEGREES_,_=o.GRID_SIZE_DEGREES_,d=e+o.LATITUDE_MAX_,a=t+o.LONGITUDE_MAX_,A=(d%=1)%i,u=(a%=1)%_;for(let e=0;e<n;e++){const e=Math.floor(A/(i/o.GRID_ROWS_)),t=Math.floor(u/(_/o.GRID_COLUMNS_));A-=e*(i/=o.GRID_ROWS_),u-=t*(_/=o.GRID_COLUMNS_),r+=o.CODE_ALPHABET_.charAt(e*o.GRID_COLUMNS_+t)}return r}static decodePairs(e){const t=o.decodePairsSequence(e,0),n=o.decodePairsSequence(e,1);return new i(t[0]-o.LATITUDE_MAX_,n[0]-o.LONGITUDE_MAX_,t[1]-o.LATITUDE_MAX_,n[1]-o.LONGITUDE_MAX_,e.length)}static decodePairsSequence(e,t){let n=0,r=0;for(;2*n+t<e.length;)r+=o.CODE_ALPHABET_.indexOf(e.charAt(2*n+t))*o.PAIR_RESOLUTIONS_[n],n+=1;return[r,r+o.PAIR_RESOLUTIONS_[n-1]]}static decodeGrid(e){let t=0,n=0,r=o.GRID_SIZE_DEGREES_,_=o.GRID_SIZE_DEGREES_,d=0;for(;d<e.length;){const i=o.CODE_ALPHABET_.indexOf(e.charAt(d)),a=Math.floor(i/o.GRID_COLUMNS_),A=i%o.GRID_COLUMNS_;t+=a*(r/=o.GRID_ROWS_),n+=A*(_/=o.GRID_COLUMNS_),d+=1}return new i(t,n,t+r,n+_,e.length)}}o.CODE_PRECISION_NORMAL=10,o.CODE_PRECISION_EXTRA=11,o.MAX_DIGIT_COUNT=15,o.SEPARATOR_="+",o.SEPARATOR_POSITION_=8,o.PADDING_CHARACTER_="0",o.CODE_ALPHABET_="23456789CFGHJMPQRVWX",o.ENCODING_BASE_=o.CODE_ALPHABET_.length,o.LATITUDE_MAX_=n,o.LONGITUDE_MAX_=r,o.PAIR_CODE_LENGTH_=10,o.PAIR_RESOLUTIONS_=[20,1,.05,.0025,125e-6],o.GRID_COLUMNS_=4,o.GRID_ROWS_=5,o.GRID_SIZE_DEGREES_=125e-6,o.MIN_TRIMMABLE_CODE_LEN_=6,t.default=o}(n={exports:{}},n.exports),n.exports),o=(r=i)&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,_=(i.CodeArea,"23456789CFGHJMPQRVWX0+"),d="FGHJKLMNOPQRSTUVXWYZA9";function a(e){if(!o.isValid(e))throw new Error("The openLocationCode is not valid");for(var t="",n=0;n<e.length;n++){var r=_.indexOf(e[n]);t+=d[r]}return t}function A(e){if(!u(e))throw new Error("The iotaAreaCode is not valid");return E(e)}function u(e){var t=new RegExp("^["+d+"]*$").test(e);return t&&(t=o.isValid(E(e))),t}function E(e){for(var t="",n=0;n<e.length;n++){var r=d.indexOf(e[n]);t+=_[r]}return t}e.CodePrecision=t,e.encode=function(e,n,r){if(void 0===r&&(r=t.NORMAL),r<2)throw new Error("The precision is not valid");return a(o.encode(e,n,r))},e.decode=function(e){var t=o.decode(A(e));return{latitude:t.latitudeCenter,longitude:t.longitudeCenter,codePrecision:t.codeLength,latitudeLow:t.latitudeLo,latitudeHigh:t.latitudeHi,longitudeLow:t.longitudeLo,longitudeHigh:t.longitudeHi}},e.fromOpenLocationCode=a,e.toOpenLocationCode=A,e.isValid=u,e.extract=function(e){var t="(["+d.substr(0,9)+"]["+d.substr(0,18)+"]["+d.substr(0,21)+"]{6}9(?:["+d.substr(0,20)+"]{2,3})?)",n=new RegExp(t).exec(e);return n?n[1]:void 0},Object.defineProperty(e,"__esModule",{value:!0})});
